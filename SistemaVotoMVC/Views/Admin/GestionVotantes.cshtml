@model IEnumerable<SistemaVotoModelos.Votante>
@{ Layout = null; }
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <title>Gestión de Usuarios</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" />
</head>
<body class="bg-light">
    <nav class="navbar navbar-dark bg-dark p-3 shadow-sm">
        <div class="container-fluid">
            <a asp-action="Main" class="btn btn-outline-light btn-sm"><i class="bi bi-arrow-left"></i> Volver</a>
            <span class="navbar-brand">🛡️ Administración de Usuarios</span>
            <a asp-action="Logout" asp-controller="Aut" class="btn btn-danger btn-sm">Cerrar Sesión</a>
        </div>
    </nav>

    <div class="container mt-4">
        @if (TempData["Mensaje"] != null) { <div class="alert alert-success alert-dismissible fade show">@TempData["Mensaje"]<button type="button" class="btn-close" data-bs-dismiss="alert"></button></div> }
        @if (TempData["Error"] != null) { <div class="alert alert-danger alert-dismissible fade show">@TempData["Error"]<button type="button" class="btn-close" data-bs-dismiss="alert"></button></div> }

        <div class="card shadow-sm border-0">
            <div class="card-header bg-white d-flex justify-content-between py-3 align-items-center">
                <h5 class="mb-0">Padrón Electoral</h5>
                <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#modalNuevo">Registrar Nuevo</button>
            </div>
            <div class="card-body">
                <table class="table table-hover align-middle">
                    <thead>
                        <tr><th>Cédula</th><th>Nombre</th><th>Email</th><th>Rol</th><th>Acciones</th></tr>
                    </thead>
                    <tbody>
                        @foreach(var v in Model) {
                        <tr>
                            <td>@v.Cedula</td>
                            <td>@v.NombreCompleto</td>
                            <td>@v.Email</td>
                            <td><span class="badge @(v.RolId == 1 ? "bg-danger" : "bg-primary")">Rol @v.RolId</span></td>
                            <td class="d-flex gap-2">
                                --<button class="btn btn-sm btn-info text-white" onclick="abrirEditar('@v.Cedula', '@v.NombreCompleto', '@v.Email', '@v.RolId', )">Editar</button>--
                                <form asp-action="EliminarVotante" method="post">
                                    <input type="hidden" name="cedula" value="@v.Cedula" />
                                    <button class="btn btn-sm btn-outline-danger" onclick="return confirm('¿Eliminar?')">Borrar</button>
                                </form>
                            </td>
                        </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalNuevo" tabindex="-1">
        <div class="modal-dialog">
            <form asp-action="CrearVotante" method="post" class="modal-content shadow border-0">
                <div class="modal-header bg-primary text-white"><h5>Nuevo Registro</h5></div>
                <div class="modal-body">
                    <label class="fw-bold">Rol</label>
                    <select name="RolId" class="form-select mb-3" onchange="validar(this, 'passInput')">
                        <option value="2">Votante (Ciudadano)</option>
                        <option value="3">Jefe de Junta</option>
                        <option value="1">Administrador</option>
                    </select>
                    <label class="fw-bold">Cédula</label><input name="Cedula" class="form-control mb-3" required maxlength="10" />
                    <label class="fw-bold">Nombre Completo</label><input name="NombreCompleto" class="form-control mb-3" required />
                    <label class="fw-bold">Email</label><input name="Email" type="email" class="form-control mb-3" required />
                    <label class="fw-bold">ID Dirección</label><input name="DireccionId" type="number" class="form-control mb-3" value="1" />
                    <label class="fw-bold">Foto URL</label><input name="Foto" class="form-control mb-3" placeholder="foto.jpg" />
                    <label class="fw-bold">Contraseña</label><input name="Password" id="passInput" type="password" class="form-control" disabled placeholder="No requerida" />
                </div>
                <div class="modal-footer"><button type="submit" class="btn btn-primary w-100">Guardar</button></div>
            </form>
        </div>
    </div>

    <div class="modal fade" id="modalEditar" tabindex="-1">
        <div class="modal-dialog">
            <form asp-action="EditarVotante" method="post" class="modal-content shadow border-0">
                <div class="modal-header bg-info text-white"><h5>Editar Usuario</h5></div>
                <div class="modal-body">
                    <input type="hidden" name="Cedula" id="editCedula" />
                    <label class="fw-bold">Nombre Completo</label><input name="NombreCompleto" id="editNombre" class="form-control mb-3" required />
                    <label class="fw-bold">Email</label><input name="Email" id="editEmail" type="email" class="form-control mb-3" required />
                    <label class="fw-bold">Rol</label>
                    <select name="RolId" id="editRol" class="form-select mb-3" onchange="validar(this, 'editPass')">
                        <option value="2">Votante</option><option value="3">Jefe Junta</option><option value="1">Admin</option>
                    </select>
                    <label class="fw-bold">Dirección ID</label><input name="DireccionId" id="editDir" type="number" class="form-control mb-3" />
                    <label class="fw-bold">Foto</label><input name="Foto" id="editFoto" class="form-control mb-3" />
                    <label class="fw-bold">Nueva Contraseña (opcional)</label><input name="Password" id="editPass" type="password" class="form-control" disabled />
                </div>
                <div class="modal-footer"><button type="submit" class="btn btn-info text-white w-100">Actualizar</button></div>
            </form>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function validar(sel, inputId) {
            const inp = document.getElementById(inputId);
            inp.disabled = (sel.value == "2");
            inp.required = (sel.value != "2");
        }
        function abrirEditar(ced, nom, mail, rol, dir, foto) {
            document.getElementById('editCedula').value = ced;
            document.getElementById('editNombre').value = nom;
            document.getElementById('editEmail').value = mail;
            document.getElementById('editRol').value = rol;
            document.getElementById('editDir').value = dir;
            document.getElementById('editFoto').value = foto;
            validar(document.getElementById('editRol'), 'editPass');
            new bootstrap.Modal(document.getElementById('modalEditar')).show();
        }
    </script>
</body>
</html>